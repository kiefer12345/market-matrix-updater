<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¸‚åœºæ•°æ®çŸ©é˜µ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'SF Mono', 'Consolas', 'Monaco', monospace;
            background: #0d1117;
            color: #e6edf3;
            padding: 12px;
            font-size: 13px;
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            padding-bottom: 8px;
            border-bottom: 1px solid #30363d;
        }
        
        .title {
            font-size: 16px;
            font-weight: 600;
            color: #58a6ff;
        }
        
        .update-time {
            font-size: 11px;
            color: #8b949e;
        }
        
        .matrix-container {
            overflow-x: auto;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 12px;
        }
        
        th {
            background: #161b22;
            color: #8b949e;
            font-weight: 500;
            text-align: right;
            padding: 8px 10px;
            border-bottom: 1px solid #30363d;
            position: sticky;
            top: 0;
            white-space: nowrap;
        }
        
        th:first-child {
            text-align: left;
            min-width: 120px;
        }
        
        td {
            padding: 6px 10px;
            text-align: right;
            border-bottom: 1px solid #21262d;
            white-space: nowrap;
        }
        
        td:first-child {
            text-align: left;
            color: #e6edf3;
            font-weight: 500;
        }
        
        tr:hover {
            background: #161b22;
        }
        
        .positive {
            color: #3fb950;
        }
        
        .negative {
            color: #f85149;
        }
        
        .neutral {
            color: #8b949e;
        }
        
        .price {
            color: #e6edf3;
            font-weight: 500;
        }
        
        /* åˆ†ç±»æ ‡é¢˜è¡Œ */
        .category-row {
            background: #1c2128 !important;
        }
        
        .category-row td {
            color: #58a6ff;
            font-weight: 600;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 10px;
            border-bottom: 1px solid #30363d;
        }
        
        /* ç‰¹æ®ŠæŒ‡æ ‡æ ·å¼ */
        .indicator-row {
            background: #1a1f24;
        }
        
        /* è¿·ä½ å›¾æ ‡ */
        .trend-up::before {
            content: "â–² ";
            font-size: 8px;
        }
        
        .trend-down::before {
            content: "â–¼ ";
            font-size: 8px;
        }
        
        /* åŠ è½½çŠ¶æ€ */
        .loading {
            text-align: center;
            padding: 40px;
            color: #8b949e;
        }
        
        .loading::after {
            content: '';
            animation: dots 1.5s infinite;
        }
        
        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }
        
        /* å“åº”å¼ */
        @media (max-width: 768px) {
            body {
                font-size: 11px;
                padding: 8px;
            }
            
            th, td {
                padding: 5px 6px;
            }
            
            .title {
                font-size: 14px;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="title">ğŸ“Š å¸‚åœºæ•°æ®çŸ©é˜µ</div>
        <div class="update-time" id="updateTime">åŠ è½½ä¸­...</div>
    </div>
    
    <div class="matrix-container">
        <table id="matrixTable">
            <thead>
                <tr>
                    <th>èµ„äº§</th>
                    <th>æ”¶ç›˜ä»·</th>
                    <th>1å¤©</th>
                    <th>1æ˜ŸæœŸ</th>
                    <th>1ä¸ªæœˆ</th>
                    <th>QTD</th>
                    <th>YTD</th>
                    <th>1å¹´</th>
                </tr>
            </thead>
            <tbody id="matrixBody">
                <tr><td colspan="8" class="loading">æ­£åœ¨åŠ è½½æ•°æ®</td></tr>
            </tbody>
        </table>
    </div>

    <script>
        // èµ„äº§åˆ†ç±»
        const categories = {
            "è´§å¸ä¸åˆ©ç‡": ["ç¾å…ƒ", "2å¹´ç¾å€º", "10å¹´ç¾å€º", "TLT"],
            "ä¸»è¦æŒ‡æ•°": ["æ ‡æ™®500", "çº³æŒ‡", "é“æŒ‡", "ç½—ç´ 2000", "æ ‡æ™®ç­‰æƒæŒ‡æ•°"],
            "é£æ ¼å› å­": ["ç½—ç´ 1000ä»·å€¼", "ç½—ç´ 1000æˆé•¿", "å‰7å¤§ç§‘æŠ€", "è¶‹åŠ¿æ¿å—"],
            "å•†å“": ["é»„é‡‘", "WTIåŸæ²¹", "æ¯”ç‰¹å¸"],
            "è¡Œä¸šæ¿å—": ["ç§‘æŠ€", "èŠ¯ç‰‡", "èƒ½æº", "é“¶è¡Œ", "ä¿é™©æ¿å—", "åŒ»ç–—", "é€šè®¯æœåŠ¡", "éå¿…éœ€å“æ¶ˆè´¹", "å¿…éœ€å“æ¶ˆè´¹", "å…¬å…±äº‹ä¸š", "REITS"],
            "å¸‚åœºæƒ…ç»ª": ["VIX", "PUT/CALL", "åƒåœ¾å€ºåˆ¸åˆ©å·®"]
        };
        
        // ç‰¹æ®ŠæŒ‡æ ‡ï¼ˆæ˜¾ç¤ºç»å¯¹å€¼å˜åŒ–è€Œéç™¾åˆ†æ¯”ï¼‰
        const absoluteChangeIndicators = ["PUT/CALL", "åƒåœ¾å€ºåˆ¸åˆ©å·®", "VIX", "2å¹´ç¾å€º", "10å¹´ç¾å€º"];
        
        // æ ¼å¼åŒ–æ•°å€¼
        function formatValue(value, isPrice = false, isAbsolute = false) {
            if (value === null || value === undefined) return '-';
            
            if (isPrice) {
                // ä»·æ ¼æ ¼å¼
                if (Math.abs(value) >= 1000) {
                    return value.toLocaleString('en-US', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                } else if (Math.abs(value) >= 100) {
                    return value.toFixed(2);
                } else if (Math.abs(value) >= 1) {
                    return value.toFixed(2);
                } else {
                    return value.toFixed(4);
                }
            }
            
            if (isAbsolute) {
                // ç»å¯¹å€¼å˜åŒ–ï¼ˆå¦‚åˆ©å·®ã€æ¯”ç‡ï¼‰
                const sign = value > 0 ? '+' : '';
                return sign + value.toFixed(2);
            }
            
            // ç™¾åˆ†æ¯”æ ¼å¼
            const percent = value * 100;
            const sign = percent > 0 ? '+' : '';
            return sign + percent.toFixed(2) + '%';
        }
        
        // è·å–é¢œè‰²ç±»
        function getColorClass(value, invert = false) {
            if (value === null || value === undefined || value === 0) return 'neutral';
            
            // VIXå’ŒPUT/CALLä¸Šæ¶¨å®é™…æ˜¯è´Ÿé¢ä¿¡å·ï¼Œæ‰€ä»¥é¢œè‰²åè½¬
            if (invert) {
                return value > 0 ? 'negative' : 'positive';
            }
            return value > 0 ? 'positive' : 'negative';
        }
        
        // åˆ¤æ–­æ˜¯å¦éœ€è¦åè½¬é¢œè‰²
        function shouldInvertColor(assetName) {
            const invertAssets = ['VIX', 'PUT/CALL', 'åƒåœ¾å€ºåˆ¸åˆ©å·®'];
            return invertAssets.includes(assetName);
        }
        
        // æ¸²æŸ“è¡¨æ ¼
        function renderTable(data) {
            const tbody = document.getElementById('matrixBody');
            tbody.innerHTML = '';
            
            const assets = data.assets || {};
            
            for (const [category, assetList] of Object.entries(categories)) {
                // åˆ†ç±»æ ‡é¢˜è¡Œ
                const categoryRow = document.createElement('tr');
                categoryRow.className = 'category-row';
                categoryRow.innerHTML = `<td colspan="8">${category}</td>`;
                tbody.appendChild(categoryRow);
                
                // è¯¥åˆ†ç±»ä¸‹çš„èµ„äº§
                for (const assetName of assetList) {
                    const assetData = assets[assetName];
                    if (!assetData) continue;
                    
                    const row = document.createElement('tr');
                    const isAbsolute = absoluteChangeIndicators.includes(assetName);
                    const invert = shouldInvertColor(assetName);
                    
                    // ç‰¹æ®ŠæŒ‡æ ‡è¡Œæ ·å¼
                    if (["VIX", "PUT/CALL", "åƒåœ¾å€ºåˆ¸åˆ©å·®"].includes(assetName)) {
                        row.className = 'indicator-row';
                    }
                    
                    const fields = ['1å¤©', '1æ˜ŸæœŸ', '1ä¸ªæœˆ', 'QTD', 'YTD', '1å¹´'];
                    
                    let html = `<td>${assetName}</td>`;
                    html += `<td class="price">${formatValue(assetData['æ”¶ç›˜ä»·'], true)}</td>`;
                    
                    for (const field of fields) {
                        const value = assetData[field];
                        const colorClass = getColorClass(value, invert);
                        const trendClass = value > 0 ? 'trend-up' : (value < 0 ? 'trend-down' : '');
                        html += `<td class="${colorClass} ${trendClass}">${formatValue(value, false, isAbsolute)}</td>`;
                    }
                    
                    row.innerHTML = html;
                    tbody.appendChild(row);
                }
            }
            
            // æ›´æ–°æ—¶é—´
            document.getElementById('updateTime').textContent = 
                `æ›´æ–°æ—¶é—´: ${data.updateTime || 'æœªçŸ¥'}`;
        }
        
        // åŠ è½½æ•°æ®
        async function loadData() {
            try {
                // å°è¯•ä»åŒç›®å½•åŠ è½½ data.json
                const response = await fetch('data.json?' + Date.now());
                if (!response.ok) throw new Error('Failed to fetch');
                const data = await response.json();
                renderTable(data);
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('matrixBody').innerHTML = 
                    '<tr><td colspan="8" style="text-align:center;color:#f85149;">åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</td></tr>';
            }
        }
        
        // åˆå§‹åŒ–
        loadData();
        
        // æ¯5åˆ†é’Ÿè‡ªåŠ¨åˆ·æ–°
        setInterval(loadData, 5 * 60 * 1000);
    </script>
</body>
</html>
